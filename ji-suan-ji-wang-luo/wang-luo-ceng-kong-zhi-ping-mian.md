# 网络层控制平面

## 网络层：控制平面

选路算法的目的：选择"好的"路径，这里的"好"，是通过一些指标来表示的（统称为费用），比如可以通过距离，也可以通过流量，经过的路由器的数量，可以根据不同的算法来做出选择

### 算法的分类

1. 全局选路算法：所有的路由器都知道整个网络拓扑图以及链路的费用信息
2. 分散式选路算法：每一个路由器仅仅知道与其相连的链路的费用信息，通过迭代的计算过程中，和相邻的结点交换信息
3. 静态选路算法
4. 动态选路算法
5. 负载敏感算法
6. 负载迟钝算法

## 链路状态路由选择算法 （ospf）

通过迪杰特斯拉算法，直接运行即可，为了获取所有的路由器的状态信息，每一个路由器都要将状态广播出去

可能会产生震荡，因为在选择了路径之后，流量就会按照这个最优的路径走，这样，最优的路径上面的费用就高了，可能下一次就不是最优的路径了，甚至可能会和上一次翻转过来

## 距离向量路由选择算法 （rip）

通过bellman-fold算法，接收到一个点的路由状态向量表之后，直接运行一轮算法即可，不需要运行2重循环，如果状态改变了，就向相邻的结点发送最新的向量表，否则什么都不做

这个操作是异步的，迭代的，分布式的

对于这个算法，在链路的状态变好的时候，很快就能跟新到正确状态，但是，如果是状态变坏的消息，可能需要很多轮（**来回反复传播**）才能跟新为正确的值，也就是好消息传播块，坏消息传播慢，最坏情况甚至会产生无穷计数的问题，可以通过增加**毒性逆转**的技术来避免（但是也仅能避免2个节点的环路）

rip协议是距离向量算法，相邻的两个点之间的链路费用为1，也就是只考虑从源到目标经过了多少个路由器，多少"跳"

## 层次路由

将区域划分为很多个AS（自治系统），在相同的AS内部的路由器运行相同的选路算法（rip或者ospf），不同的AS之间运行BGP协议

划分区域的好处就是，使用洪泛法交换链路的状态信息的时候，范围局限于单个AS内即可，减少了整个网络上的通信量

## 问题解答

1. 路由和转发的区别

   路由是进行路径的选择的操作，通常由软件完成，转发是将分组转发到对应的interface上，通常由硬件完成

2. tcp和ip的报文的头部大小通常为多少

   这两者的头部大小通常为20字节，这个20字节是为了完成本层的协议锁规定的功能而在上一层的数据部分的基础上增加的头部信息，因为还有选项字段，所以可变

3. ip数据包分片的时候，不同片的信息，哪些是相同的，哪些是不同的

   分片之后，为了让接收方知道分片是否已经组装完整，需要提供标志位，如果不是最后一个分片，那么标志位1，最后一个分片的标志位为0，每一个片段的识别号是相同的，是为了让接收方知道这是一个数据包的多个分片，每一个片段的偏移量都不同，偏移量的计算公式： 之前的所有的分片的数据长度和/8

4. 比较链路状态算法和距离向量路由算法

   前者是使用完整的，全局的路由知识来计算源和目的地之间的最小成本路径，使用了迪杰特斯拉算法，后者的计算是迭代的，分布式的，节点只知道它应该向其转发数据包的邻居，以便沿着成本最低的路径发送到目的地，以及从自身到目的地的成本

5. ospf协议只需要将链路状态信息发送到相邻的结点？

   错，需要将链路状态信息发送到其余所有的结点，这样才能构造完整的AS链路状态信息，然后才能在本地运行dijkstra算法

6. 6
7. 7
8. 8

